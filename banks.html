<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Banks — Income & Expense</title>

<style>
  :root {
    --bg: #071024;
    --card: #07182a;
    --muted: #9aa4b2;
    --accent: #38bdf8;
    --accent-2: #60a5fa;
  }

  body {
    font-family: Inter, Arial, sans-serif;
    background: var(--bg);
    color: #e6eef6;
    margin: 18px;
  }

  .card {
    background: var(--card);
    padding: 14px;
    border-radius: 10px;
    margin-bottom: 12px;
  }

  input, select {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.06);
    background: #0e1527;
    color: #e6eef6;
    width: 100%;
    box-sizing: border-box;
  }

  button {
    padding: 8px 10px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: linear-gradient(90deg, var(--accent-2), var(--accent));
    color: white;
    transition: opacity 0.2s, transform 0.2s;
  }
  button:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }

  nav a {
    color: var(--muted);
    text-decoration: none;
    margin: 0 6px;
    font-size: 14px;
  }
  nav a:hover {
    color: var(--accent);
  }

  header h2 {
    font-weight: 600;
    background: linear-gradient(90deg, var(--accent), #7dd3fc);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    display: inline-block;
    margin: 0;
  }

  label {
    display: block;
    margin-top: 6px;
  }

  #banksArea div {
    transition: background 0.2s;
  }
  #banksArea div:hover {
    background: rgba(255, 255, 255, 0.03);
  }

  /* Footer */
  footer {
    text-align: center;
    margin-top: 20px;
    font-size: 13px;
    color: var(--muted);
  }
</style>
</head>

<body>
  <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
    <h2>Bank Accounts</h2>
    <nav>
      <a href="index.html">Dashboard</a> |
      <a href="banks.html">Banks</a> |
      <a href="transactions.html">Transactions</a>
    </nav>
  </header>

  <div class="card">
    <strong>Manage Banks</strong>
    <div style="margin-top:8px;display:flex;gap:8px">
      <input id="newBankName" placeholder="New bank name" />
      <button id="addBankBtn">Add</button>
    </div>
    <div style="margin-top:8px" id="banksArea"></div>
  </div>

  <div class="card">
    <strong>Intra-bank Transfer</strong>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:8px">
      <div>
        <label>From</label>
        <select id="transferFrom"></select>
      </div>
      <div>
        <label>To</label>
        <select id="transferTo"></select>
      </div>
      <div>
        <label>Amount (₹)</label>
        <input id="transferAmt" type="number" step="0.01" />
      </div>
    </div>
    <div style="margin-top:8px;display:flex;gap:8px">
      <input id="transferDate" placeholder="DD-MM-YYYY" />
      <input id="transferNotes" placeholder="Optional note" />
      <button id="doTransfer">Transfer</button>
    </div>
  </div>

  <footer>
    Created with © Copyright <strong>Subair V M</strong>
  </footer>

  <script src="data.js"></script>
  <script>
    const $id = (a) => document.getElementById(a);

    function render() {
      const st = DataStore.getState();
      const banks = DataStore.balancesPerBank();
      const area = $id("banksArea");
      area.innerHTML = "";

      banks.forEach((b) => {
        const div = document.createElement("div");
        div.style.display = "flex";
        div.style.justifyContent = "space-between";
        div.style.padding = "8px";
        div.style.borderBottom = "1px dashed rgba(255,255,255,0.03)";
        div.innerHTML = `
          <div>
            <strong>${escape(b.name)}</strong>
            <div style='font-size:12px;color:#9aa4b2'>${b.count} txns</div>
          </div>
          <div style='text-align:right'>
            <div>${fmtAmt(b.balance)}</div>
            <div style='font-size:12px;color:#9aa4b2'>inc ${fmtAmt(b.income)} • exp ${fmtAmt(b.expense)}</div>
            <div style='margin-top:6px'>
              <button data-edit="${b.id}" style="background:#4b5563">Edit</button>
            </div>
          </div>`;
        area.appendChild(div);
      });

      // Add edit button functionality
      area.querySelectorAll("[data-edit]").forEach((btn) =>
        btn.addEventListener("click", () => {
          const id = btn.dataset.edit;
          const st = DataStore.getState();
          const bank = st.banks.find((x) => x.id === id);
          if (!bank) return;
          const newName = prompt("Edit bank name:", bank.name);
          if (newName && newName.trim()) {
            DataStore.updateBankName(id, newName.trim());
            render();
          }
        })
      );

      // Refill select boxes
      ["transferFrom", "transferTo"].forEach((selId) => {
        const sel = $id(selId);
        sel.innerHTML = "";
        const opt0 = document.createElement("option");
        opt0.value = "";
        opt0.textContent = "Unassigned";
        sel.appendChild(opt0);
        st.banks.forEach((b) => {
          const o = document.createElement("option");
          o.value = b.id;
          o.textContent = b.name;
          sel.appendChild(o);
        });
      });
    }

    // Add bank
    $id("addBankBtn").addEventListener("click", () => {
      const name = $id("newBankName").value.trim();
      if (!name) return;
      DataStore.addBank(name);
      $id("newBankName").value = "";
      render();
    });

    // Transfer
    $id("doTransfer").addEventListener("click", () => {
      const from = $id("transferFrom").value || null;
      const to = $id("transferTo").value || null;
      const amt = Number($id("transferAmt").value) || 0;
      const date = $id("transferDate").value
        ? new Date($id("transferDate").value).toISOString()
        : new Date().toISOString();
      const notes = $id("transferNotes").value.trim();
      if (!amt || amt <= 0) {
        alert("Enter positive amount");
        return;
      }
      if (from === to && from !== "") {
        alert("Select different banks for transfer");
        return;
      }
      DataStore.transfer(from, to, amt, date, notes);
      alert("Transfer complete");
      render();
    });

    function escape(s) {
      if (s == null) return "";
      return String(s).replace(/[&<>"']/g, (m) =>
        ({
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#39;",
        }[m])
      );
    }

    // Add new helper to DataStore for editing bank name
    if (!DataStore.updateBankName) {
      DataStore.updateBankName = function (id, newName) {
        const st = this.getState();
        const idx = st.banks.findIndex((b) => b.id === id);
        if (idx >= 0) {
          st.banks[idx].name = newName;
          this.saveState(st);
        }
      };
    }

    // Initialize
    render();
    window.addEventListener("focus", render);
  </script>
</body>
</html>
